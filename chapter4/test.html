<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JSX 실행 테스트</title>
  <!-- React, ReactDOM CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel CDN (JSX 변환용) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script> <!-- Tailwind도 CDN으로 불러오기 -->
</head>
<body>
  <div id="root"></div>

  <!-- JSX 코드 -->
  <script type="text/babel">
    // import 제거 → React, ReactDOM은 전역에서 사용 가능
    const { useEffect, useMemo, useRef, useState } = React;

    function useLocalStorage(key, initialValue) {
      const [value, setValue] = useState(() => {
        try {
          const raw = localStorage.getItem(key);
          return raw ? JSON.parse(raw) : initialValue;
        } catch {
          return initialValue;
        }
      });
      useEffect(() => {
        try {
          localStorage.setItem(key, JSON.stringify(value));
        } catch {}
      }, [key, value]);
      return [value, setValue];
    }

    function uid() {
      if (typeof crypto !== "undefined" && crypto.randomUUID) return crypto.randomUUID();
      return `t_${Date.now()}_${Math.random().toString(16).slice(2)}`;
    }

    const FILTERS = {
      all: { label: "All", fn: () => true },
      active: { label: "Active", fn: (t) => !t.done },
      completed: { label: "Completed", fn: (t) => t.done },
    };

    function TodoApp() {
      const [todos, setTodos] = useLocalStorage("todos.v1", []);
      const [text, setText] = useState("");
      const [filter, setFilter] = useState("all");
      const [search, setSearch] = useState("");
      const [editingId, setEditingId] = useState(null);
      const [editingText, setEditingText] = useState("");
      const inputRef = useRef(null);

      useEffect(() => { inputRef.current?.focus(); }, []);

      const filtered = useMemo(() => {
        const byFilter = todos.filter(FILTERS[filter].fn);
        const q = search.trim().toLowerCase();
        return q ? byFilter.filter((t) => t.text.toLowerCase().includes(q)) : byFilter;
      }, [todos, filter, search]);

      const stats = useMemo(() => {
        const total = todos.length;
        const completed = todos.filter((t) => t.done).length;
        const active = total - completed;
        return { total, completed, active };
      }, [todos]);

      function addTodo() {
        const val = text.trim();
        if (!val) return;
        const newTodo = { id: uid(), text: val, done: false, createdAt: Date.now() };
        setTodos([newTodo, ...todos]);
        setText("");
        inputRef.current?.focus();
      }

      function toggle(id) {
        setTodos((prev) => prev.map((t) => (t.id === id ? { ...t, done: !t.done } : t)));
      }

      function remove(id) {
        setTodos((prev) => prev.filter((t) => t.id !== id));
      }

      function clearCompleted() {
        setTodos((prev) => prev.filter((t) => !t.done));
      }

      function startEdit(todo) {
        setEditingId(todo.id);
        setEditingText(todo.text);
      }

      function saveEdit() {
        const val = editingText.trim();
        if (!editingId) return;
        if (!val) {
          setTodos((prev) => prev.filter((t) => t.id !== editingId));
        } else {
          setTodos((prev) => prev.map((t) => (t.id === editingId ? { ...t, text: val } : t)));
        }
        setEditingId(null);
        setEditingText("");
      }

      function cancelEdit() {
        setEditingId(null);
        setEditingText("");
      }

      function toggleAll(done) {
        setTodos((prev) => prev.map((t) => ({ ...t, done })));
      }

      return (
        <div className="min-h-screen bg-gray-50 text-gray-900 p-6">
          <h1 className="text-2xl font-bold mb-4">Todo List</h1>
          <input
            ref={inputRef}
            value={text}
            onChange={(e) => setText(e.target.value)}
            onKeyDown={(e) => e.key === "Enter" && addTodo()}
            placeholder="Add a new task"
            className="border px-3 py-2 rounded mr-2"
          />
          <button onClick={addTodo} className="px-3 py-2 bg-gray-200 rounded">Add</button>

          <ul className="mt-4 space-y-2">
            {filtered.map((todo) => (
              <li key={todo.id} className="flex items-center gap-2">
                <input type="checkbox" checked={todo.done} onChange={() => toggle(todo.id)} />
                <span className={todo.done ? "line-through text-gray-500" : ""}>{todo.text}</span>
                <button onClick={() => remove(todo.id)} className="ml-auto text-red-500">Delete</button>
              </li>
            ))}
          </ul>
        </div>
      );
    }

    // 여기서 앱 실행!
    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<TodoApp />);
  </script>
</body>
</html>
